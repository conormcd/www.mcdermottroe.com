machine:
  php:
    version: 5.6.5

dependencies:
  cache_directories:
    - vendor
  override:
    - sed -i 's/^;//' ~/.phpenv/versions/$(phpenv global)/etc/conf.d/xdebug.ini
    - pecl install -f memcached-2.0.1
    - composer install --prefer-source --no-interaction || (rm -rf vendor; composer install --prefer-source --no-interaction; find vendor -type d -name .git -exec rm -rf {} +)

test:
  override:
    - vendor/bin/phpunit --verbose --log-junit ${CIRCLE_TEST_REPORTS}/phpunit.xml:
        parallel: true
        files:
          - test/phpunit/*/*Test.php
